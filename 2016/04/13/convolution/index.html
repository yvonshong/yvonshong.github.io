<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>深入理解卷积 | Yvon Shong</title><meta name="author" content="Yvon Shong"><meta name="copyright" content="Yvon Shong"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="卷积相关知识的梳理">
<meta property="og:type" content="article">
<meta property="og:title" content="深入理解卷积">
<meta property="og:url" content="http://www.yvonshong.com/2016/04/13/convolution/index.html">
<meta property="og:site_name" content="Yvon Shong">
<meta property="og:description" content="卷积相关知识的梳理">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/HAbatdcnuM37PKf.png">
<meta property="article:published_time" content="2016-04-13T11:05:39.000Z">
<meta property="article:modified_time" content="2026-01-08T11:40:29.519Z">
<meta property="article:author" content="Yvon Shong">
<meta property="article:tag" content="matlab">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/HAbatdcnuM37PKf.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "深入理解卷积",
  "url": "http://www.yvonshong.com/2016/04/13/convolution/",
  "image": "https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/HAbatdcnuM37PKf.png",
  "datePublished": "2016-04-13T11:05:39.000Z",
  "dateModified": "2026-01-08T11:40:29.519Z",
  "author": [
    {
      "@type": "Person",
      "name": "Yvon Shong",
      "url": "http://www.yvonshong.com"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/screenshot-20251210-230924.png"><link rel="canonical" href="http://www.yvonshong.com/2016/04/13/convolution/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '深入理解卷积',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Yvon Shong" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/screenshot-20251210-230924.png" data-lazy-src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/HAbatdcnuM37PKf.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/tech/"><i class="fa-fw fas fa-microchip"></i><span> 技术</span></a></div><div class="menus_item"><a class="site-page" href="/categories/essay/"><i class="fa-fw fas fa-pen-nib"></i><span> 随笔</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Yvon Shong</span></a><a class="nav-page-title" href="/"><span class="site-name">深入理解卷积</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/tech/"><i class="fa-fw fas fa-microchip"></i><span> 技术</span></a></div><div class="menus_item"><a class="site-page" href="/categories/essay/"><i class="fa-fw fas fa-pen-nib"></i><span> 随笔</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">深入理解卷积</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2016-04-13T11:05:39.000Z" title="发表于 2016-04-13 19:05:39">2016-04-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-08T11:40:29.519Z" title="更新于 2026-01-08 19:40:29">2026-01-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/tech/">tech</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a class="disqus-comment-count" href="http://www.yvonshong.com/2016/04/13/convolution/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a></span></div></div></div><article class="container post-content" id="article-container"><p>卷积相关知识的梳理</p>
<span id="more"></span>

<h1 id="内积"><a href="#内积" class="headerlink" title="内积"></a>内积</h1><p>(a1,b1,c1)·(a2,b2,c2)=a1*a2+b1*b2+c1*c2</p>
<h1 id="相关"><a href="#相关" class="headerlink" title="相关"></a>相关</h1><p>有一个和卷积很容易混淆的概念，叫做相关</p>
<p>首先我们来比较一下：</p>
<blockquote>
<p>自相关函数	   R(x)=∫f(t)f(t-x)dt    移-积-和</p>
<p>卷积          g(x)=∫f(x)f(t-x)dt    褶-移-积-和</p>
</blockquote>
<p>相关和卷积只差一个反转的过程</p>
<p>相关描述的是：把一个信号 平移一段后，与原函数的相似程度</p>
<p>具体怎么个【褶-移-积-和】后面再讲</p>
<h2 id="相关的物理意义"><a href="#相关的物理意义" class="headerlink" title="相关的物理意义"></a>相关的物理意义</h2><p>相关最早是用来概率论中描述随机变量之间关系的概念，如相关系数。</p>
<p>实际上信号一般是一个随机过程，为了实现信号的检测、识别与提取，经常要了解两个信号的相似性，或一个信号经过一段延迟后自身的相似性。<br>但相关系数有缺陷。</p>
<p>因为分子是两个信号的内积，如sinx和cosx,从波形上看只是相位不同，而相关系数为零（因为正弦和余弦正交），因此引进相关函数，将原来两函数直接内积改为一个函数和另一个函数的延迟作内积。</p>
<p>其实二者从概念没有任何联系。由于相关函数第一个函数和第二个函数的延迟作内积（内积就是乘积累加），所以相关函数不满足交换，而卷积可以。延迟不同结果不同，所以相关系数是个数，而相关函数是函数，是<strong>延迟</strong>的函数。</p>
<h1 id="卷积"><a href="#卷积" class="headerlink" title="卷积"></a>卷积</h1><p>在泛函分析中，卷积是通过两个函数f和g生成第三个函数的一种数学算子，表征函数f与 经过<strong>翻转</strong>和<strong>平移</strong>的g 的重叠部分的累积。<br>如果将参加卷积的一个函数看作区间的指示函数，卷积还可以被看作是“滑动加权平均”的推广。</p>
<h2 id="一维信号"><a href="#一维信号" class="headerlink" title="一维信号"></a>一维信号</h2><p>g(x)=∫f(x)f(t-x)dt </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">褶：f(x) -&gt; f(-x)</span><br><span class="line">移：f(-x) -&gt; f(t-x)</span><br><span class="line">积：f(x)f(t-x)</span><br><span class="line">和：∫f(x)f(t-x)dt</span><br></pre></td></tr></tbody></table></figure>

<p>反转平移之后重叠部分做内积(乘积累加)</p>
<p>某种意义上，对任意一个t，h(t)对它做了一个<strong>相同模式</strong>的贡献／变化</p>
<h2 id="一些便于理解的例子"><a href="#一些便于理解的例子" class="headerlink" title="一些便于理解的例子"></a>一些便于理解的例子</h2><p>辐射：设某核电站事故中，某工作人员每天到抢险现场工作T分钟，接受一定剂量的辐射，辐射会自然地衰减，如此工作N天，如何计算总的辐射量？</p>
<p>信号：一个物体时刻会受到一个周期性的固定模式的的能量的冲击。并且，物体在受到某个时刻的能量后，会按照一个关于时间的函数进行变化。<br>如何计算 某个时刻 之前所有冲击信号的遗留和现在受到的冲击信号的能量之和？</p>
<p>复利：</p>
<table>
<thead>
<tr>
<th><strong>本金</strong></th>
<th><strong>第一年</strong></th>
<th><strong>第二年</strong></th>
<th><strong>第三年</strong></th>
<th><strong>第四年</strong></th>
<th><strong>第五年</strong></th>
</tr>
</thead>
<tbody><tr>
<td>+100</td>
<td>100*(1.05)^1</td>
<td>100*(1.05)^2</td>
<td>100*(1.05)^3</td>
<td>100*(1.05)^4</td>
<td>100*(1.05)^5</td>
</tr>
<tr>
<td></td>
<td>+200</td>
<td>200*(1.05)^1</td>
<td>200*(1.05)^2</td>
<td>200*(1.05)^3</td>
<td>200*(1.05)^4</td>
</tr>
<tr>
<td></td>
<td></td>
<td>+300</td>
<td>300*(1.05)^1</td>
<td>300*(1.05)^2</td>
<td>300*(1.05)^3</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>+300</td>
<td>300*(1.05)^1</td>
<td>300*(1.05)^2</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+200</td>
<td>200*(1.05)^1</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+100</td>
</tr>
</tbody></table>
<p>多项式乘法：</p>
<p><img src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/screenshot-20251210-230924.png" data-lazy-src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/6b2f6355ly1fyo4iv2udbj21aw0ujac1.jpg"></p>
<p>多项式a(n1)乘多项式b(n2)</p>
<p>对应的系数矩阵(向量)为a[最高次的系数,…,常数项系数] 和 b[最高次的系数,…,常数项系数]</p>
<p>多项式相乘结果的系数为c[最高次的系数,…,常数项系数]</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c(i)=\sum_{k=0}^i a(k)b(i-k),i=0~(n1+n2)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="二维图像"><a href="#二维图像" class="headerlink" title="二维图像"></a>二维图像</h2><p>对应一维信号处理过程，把时间t的定义域空间换成图像的平面矩阵形状空间</p>
<h3 id="二维离散卷积公式"><a href="#二维离散卷积公式" class="headerlink" title="二维离散卷积公式"></a>二维离散卷积公式</h3><p><img src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/screenshot-20251210-230924.png" data-lazy-src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/6b2f6355ly1fyo4iv43egj20nk09haad.jpg"></p>
<h3 id="二维连续卷积公式"><a href="#二维连续卷积公式" class="headerlink" title="二维连续卷积公式"></a>二维连续卷积公式</h3><p>(f*g)(t1,t2)=∫∫f(x1,x2)g(t1-x1,t2-x2)dx1 dx2</p>
<h3 id="一些例子的理解"><a href="#一些例子的理解" class="headerlink" title="一些例子的理解"></a>一些例子的理解</h3><h4 id="将图像按照模板进行处理"><a href="#将图像按照模板进行处理" class="headerlink" title="将图像按照模板进行处理"></a>将图像按照模板进行处理</h4><p>对于图像而言，离散卷积的计算过程是模板翻转，然后在原图像上滑动模板，把对应位置上的元素相乘后加起来，得到最终的结果。如果不考虑翻转，这个滑动-相乘-叠加的过程就是相关操作。</p>
<h4 id="滤波"><a href="#滤波" class="headerlink" title="滤波"></a>滤波</h4><p>比如最简单的高斯模板，就是把模板内像素乘以不同的权值然后加起来作为模板的中心像素值，如果模板取值全为1，就是滑动平均；如果模板取值为高斯，就是加权滑动平均，权重是中间高，四周低，在频率上理解就是低通滤波器。</p>
<h4 id="投影"><a href="#投影" class="headerlink" title="投影"></a>投影</h4><p>因为当前模板内部图像和模板的相乘累加操作就是图像局部片段和模板的内积操作，这个过程可以看作图像的片段的空间 向 模板空间上的投影，一幅图像和一个模板卷积，得到的结果就是图像各个片段在这个空间上的投影累加和。如果这样的模板有一组，我们可以把这一组看成一组基，常见的如用一组Garbor滤波器提取图像的特征。</p>
<h2 id="总的来说"><a href="#总的来说" class="headerlink" title="总的来说"></a>总的来说</h2><p>在泛函分析中，卷积是通过两个函数f 和g 生成第三个函数的一种数学算子，表征函数f 与经过翻转和平移的g的重叠部分的累积。如果将参加卷积的一个函数看作区间的指示函数，卷积还可以被看作是“滑动加权平均”的推广。</p>
<p>（赋予不同的权值的想法）（加权累加）</p>
<p>二者在时间上不一定同步。卷积关心的正是二者在时间不同步的情况下（各个时间）激励和响应作用的结果。并且，这种响应是非因果的，即是不仅要考虑某一时刻输入信号的响应，还要全部包含这之前所有输入的响应。</p>
<h3 id="离散卷积："><a href="#离散卷积：" class="headerlink" title="离散卷积："></a>离散卷积：</h3><p>图像本身是离散的 所以权值也是离散的,模板是格子般的</p>
<p>忽略远距离的像素点的低权值影响，所以模板是有限的格子</p>
<p>权值分布的按照不同的函数分布，便是不同的卷积核，只不过受像素格的影响，是取离散的值。</p>
<p>整体就是个：褶 -&gt; 移 -&gt; 积 -&gt; 和  的过程</p>
<h3 id="卷积的类型"><a href="#卷积的类型" class="headerlink" title="卷积的类型"></a>卷积的类型</h3><h4 id="离散卷积和连续函数的卷积"><a href="#离散卷积和连续函数的卷积" class="headerlink" title="离散卷积和连续函数的卷积"></a>离散卷积和连续函数的卷积</h4><h4 id="线性卷积和循环卷积"><a href="#线性卷积和循环卷积" class="headerlink" title="线性卷积和循环卷积"></a>线性卷积和循环卷积</h4><p>通常说卷积时指的是线性卷积，在信号处理领域是跟线性时不变系统有关的一种运算</p>
<p>循环卷积我理解是使用DFT(FFT)计算线性卷积时的衍生品。</p>
<h2 id="一些问题："><a href="#一些问题：" class="headerlink" title="一些问题："></a>一些问题：</h2><h2 id="为什么要反转？"><a href="#为什么要反转？" class="headerlink" title="为什么要反转？"></a>为什么要反转？</h2><p><img src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/screenshot-20251210-230924.png" data-lazy-src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/6b2f6355ly1fyo4iv5xplj20go0et420.jpg"></p>
<p>卷积的其中一方参与者是冲击响应，它所描述的的曲线方向与时间流逝一致。而卷积的输出等于以前的信号效果累加，这个累加必然从当前时间点逆时间流逝方向进行的。很显然，离当前时间越近，那个输入残留在系统中的回响就越大。</p>
<p>也可以从之前的多项式乘法的解释上理解。</p>
<h2 id="卷积核可不可以是改变的？"><a href="#卷积核可不可以是改变的？" class="headerlink" title="卷积核可不可以是改变的？"></a>卷积核可不可以是改变的？</h2><p>某种意义上，对任意一个t，h(τ)对它做了一个相同模式的贡献／变化</p>
<p>h(t)能否是变化的？</p>
<p>g(x)=∫f(x)(t-x)dt   —–&gt;   g(x)=∫f(x)f(x,t-x)dt</p>
<p>比如考虑边缘情况，边缘时模板就不相同了。</p>
<h2 id="模板的大小是有限的"><a href="#模板的大小是有限的" class="headerlink" title="模板的大小是有限的"></a>模板的大小是有限的</h2><p>二维卷积时 什么情况才能忽略远距离的像素值呢？万一远距离的像素的权值更高呢？</p>
<p>（收敛的想法 h(t)得是收敛的）</p>
<h3 id="线性时不变系统"><a href="#线性时不变系统" class="headerlink" title="线性时不变系统"></a>线性时不变系统</h3><p>连续时间系统与离散时间系统</p>
<pre><code>线性系统有两种定义：
（1）根据系统的输入和输出关系是否具有线性来定义满足叠加原理的系统具有线性特性。即若对两个激励x1(n)和x2(n)，有T[ax1(n)+bx2(n)]=aT[x1(n)]+bT[x2(n)]，式中a、b为任意常数。不满足上述关系的为非线性系统。
（2）根据组成系统的元件特性来定义由线性元件和独立电源组成的系统。
</code></pre>
<p>时不变系统</p>
<pre><code>系统的参数不随时间而变化，即不管输入信号作用的时间先后，输出信号响应的形状均相同，仅是从出现的时间不同。用数学表示为T[x(n)]=y[n]则 T[x(n-n0)]=y[n-n0]，这说明序列x(n)先移位后进行变换与它先进行变换后再移位是等效的。 
</code></pre>
<p>线性时不变系统</p>
<pre><code>既满足叠加原理又具有时不变特性，它可以用单位脉冲响应来表示。单位脉冲响应是输入端为单位脉冲序列时的系统输出，一般表示为h(n)，即h(n)=T[δ(n)]。 
任一输入序列x(n)的相应y(n)=T[x(n)]=T[ δ(n-k)]； 
由于系统是线性的，所以上式可以写成y(n)=T[δ(n-k)]；
又由于系统是时不变的，即有T[δ(n-k)]＝h(n-k)；
从而得y(n)=h(n-k)=x(n)*h(n)； 　　
这个公式称为离散卷积，用“*”表示。
</code></pre>
<h1 id="卷积定理"><a href="#卷积定理" class="headerlink" title="卷积定理"></a>卷积定理</h1><p>两个函数卷积后的傅里叶变换=两个函数的傅里叶变换后的乘积</p>
<p>卷积定理指出，函数卷积的傅里叶变换是函数傅里叶变换的乘积。即一个域中的卷积对应于另一个域中的乘积，例如时域中的卷积对应于频域中的乘积。<br>这一定理对拉普拉斯变换、双边拉普拉斯变换、Z变换、Mellin变换和Hartley变换等各种傅里叶变换的变体同样成立。在调和分析中还可以推广到在局部紧致的阿贝尔群上定义的傅里叶变换。<br>利用卷积定理可以简化卷积的运算量。对于长度为n的序列，按照卷积的定义进行计算，需要做2n-1组对位乘法，其计算复杂度为O(n^2)；而利用傅里叶变换将序列变换到频域上后，只需要一组对位乘法，利用傅里叶变换的快速算法之后，总的计算复杂度为O(n*log n)。这一结果可以在快速乘法计算中得到应用。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/screenshot-20251210-230924.png" data-lazy-src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/6b2f6355ly1fyo4iuyhzdj20p60qdgmq.jpg"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://www.yvonshong.com">Yvon Shong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://www.yvonshong.com/2016/04/13/convolution/">http://www.yvonshong.com/2016/04/13/convolution/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://www.yvonshong.com" target="_blank">Yvon Shong</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/matlab/">matlab</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/HAbatdcnuM37PKf.png" data-sites="facebook,twitter,wechat,weibo"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>人民币版的赞</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/It31kXcofTA9UB2.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/screenshot-20251210-230924.png" data-lazy-src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/It31kXcofTA9UB2.png" alt="Wechat"/></a><div class="post-qr-code-desc">Wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2016/06/11/matlablens/" title="MatlabLens"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">MatlabLens</div></div><div class="info-2"><div class="info-item-1">本程序是基于 MATLAB 的 GUI 界面的类 Office Lens 应用，还有很多待提高  其中主要功能有  GUI 界面，方便快捷的操作 文件选择功能 透视变换 图像手动剪切 图像降噪 调节对比度 图像二值化 无限撤销功能 保存图像    详细说明 GUI 界面这次是简单的尝试了下 matlab 自带的 VB 似的 GUI 界面，异常的好用，连监听啊什么的都不用自己写。 文件选择功能利用 uioutfile 函数，调用 Windows 熟悉的文件选择    透视变换透视变换时本程序效率最低，大概需要跑 2min 的功能，利用 MIT 的算法，从左到右从上到下选择要进行透视变换的四个点，这四个点之间的图像将被处理变换为矩形，其原理是将这四个点的坐标，转换为矩形定点，联立求解四元四次方程组，得到透视变换矩阵，将透视变换矩阵作用到四个点中间的其他坐标进行变换。效率最低的地方应该就是解方程的步骤。    图像手动剪切利用 imcrop 函数，本想在透视变换后直接利用顶点坐标进行裁剪，但其实透视变换后，处理后的图像会对变换后没有像素的地方进行黑色填补，导致顶点坐标发生变化。    ...</div></div></div></a><a class="pagination-related" href="/2016/04/09/fft/" title="深入理解快速傅里叶变换"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">深入理解快速傅里叶变换</div></div><div class="info-2"><div class="info-item-1">傅里叶变换相关知识的梳理   傅里叶变换的物理意义: 时间域 &lt;-&gt; 频域的转换傅立叶原理表明：任何连续测量的时序或信号，都可以表示为不同频率的正弦波信号的无限叠加 推荐一篇关于傅里叶变换的文章 - 掐死傅里叶教程 傅里叶变换示意图  时域-相位  时域-频域-相位  傅里叶变换的种类   变换 时间 频率    连续傅里叶变换 连续，非周期性 连续，非周期性   傅里叶级数 连续，周期性 离散，非周期性   离散时间傅里叶变换 离散，非周期性 连续，周期性   离散傅里叶变换 离散，周期性 离散，周期性   mapping  时间的连续     &lt;–&gt;频率的非周期性 时间的离散     &lt;–&gt;频率的周期性 时间的非周期性  &lt;–&gt;频率的连续 时间的周期性   &lt;–&gt;频率的离散  FFT是DFT(离散傅里叶变换的快速实现) 快在哪里？DFT：按定义求值需要O(N^2)次运算 FFT：利用库利-图基算法，以分治法为策略递归地将长度为N=N1*N2的DFT分解为长度为N1的N2个较短序列的DFT 通过许多小的更加容易进行的变...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2016/04/09/fft/" title="深入理解快速傅里叶变换"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2016-04-09</div><div class="info-item-2">深入理解快速傅里叶变换</div></div><div class="info-2"><div class="info-item-1">傅里叶变换相关知识的梳理   傅里叶变换的物理意义: 时间域 &lt;-&gt; 频域的转换傅立叶原理表明：任何连续测量的时序或信号，都可以表示为不同频率的正弦波信号的无限叠加 推荐一篇关于傅里叶变换的文章 - 掐死傅里叶教程 傅里叶变换示意图  时域-相位  时域-频域-相位  傅里叶变换的种类   变换 时间 频率    连续傅里叶变换 连续，非周期性 连续，非周期性   傅里叶级数 连续，周期性 离散，非周期性   离散时间傅里叶变换 离散，非周期性 连续，周期性   离散傅里叶变换 离散，周期性 离散，周期性   mapping  时间的连续     &lt;–&gt;频率的非周期性 时间的离散     &lt;–&gt;频率的周期性 时间的非周期性  &lt;–&gt;频率的连续 时间的周期性   &lt;–&gt;频率的离散  FFT是DFT(离散傅里叶变换的快速实现) 快在哪里？DFT：按定义求值需要O(N^2)次运算 FFT：利用库利-图基算法，以分治法为策略递归地将长度为N=N1*N2的DFT分解为长度为N1的N2个较短序列的DFT 通过许多小的更加容易进行的变...</div></div></div></a><a class="pagination-related" href="/2016/06/11/matlablens/" title="MatlabLens"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2016-06-11</div><div class="info-item-2">MatlabLens</div></div><div class="info-2"><div class="info-item-1">本程序是基于 MATLAB 的 GUI 界面的类 Office Lens 应用，还有很多待提高  其中主要功能有  GUI 界面，方便快捷的操作 文件选择功能 透视变换 图像手动剪切 图像降噪 调节对比度 图像二值化 无限撤销功能 保存图像    详细说明 GUI 界面这次是简单的尝试了下 matlab 自带的 VB 似的 GUI 界面，异常的好用，连监听啊什么的都不用自己写。 文件选择功能利用 uioutfile 函数，调用 Windows 熟悉的文件选择    透视变换透视变换时本程序效率最低，大概需要跑 2min 的功能，利用 MIT 的算法，从左到右从上到下选择要进行透视变换的四个点，这四个点之间的图像将被处理变换为矩形，其原理是将这四个点的坐标，转换为矩形定点，联立求解四元四次方程组，得到透视变换矩阵，将透视变换矩阵作用到四个点中间的其他坐标进行变换。效率最低的地方应该就是解方程的步骤。    图像手动剪切利用 imcrop 函数，本想在透视变换后直接利用顶点坐标进行裁剪，但其实透视变换后，处理后的图像会对变换后没有像素的地方进行黑色填补，导致顶点坐标发生变化。    ...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/screenshot-20251210-230924.png" data-lazy-src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/HAbatdcnuM37PKf.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Yvon Shong</div><div class="author-info-description">人生应当如盛夏🔆</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="http://zhihu.com/people/yvonshong"><i class="fab fa-zhihu"></i><span>关注知乎</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://space.bilibili.com/6083595" rel="external nofollow noreferrer" target="_blank" title="Bilibili"><i class="fab fa-bilibili" style="color: #fb7299;"></i></a><a class="social-icon" href="http://github.com/yvonshong" target="_blank" title="Github"><i class="fab fa-github" style="color: #dbd6d1;"></i></a><a class="social-icon" href="mailto:yvon@shong.win" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #f0ad4e;"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss" style="color: #f26522;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%A7%AF"><span class="toc-text">内积</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3"><span class="toc-text">相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%9A%84%E7%89%A9%E7%90%86%E6%84%8F%E4%B9%89"><span class="toc-text">相关的物理意义</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%B7%E7%A7%AF"><span class="toc-text">卷积</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E7%BB%B4%E4%BF%A1%E5%8F%B7"><span class="toc-text">一维信号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E4%BE%BF%E4%BA%8E%E7%90%86%E8%A7%A3%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-text">一些便于理解的例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E7%BB%B4%E5%9B%BE%E5%83%8F"><span class="toc-text">二维图像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BB%B4%E7%A6%BB%E6%95%A3%E5%8D%B7%E7%A7%AF%E5%85%AC%E5%BC%8F"><span class="toc-text">二维离散卷积公式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BB%B4%E8%BF%9E%E7%BB%AD%E5%8D%B7%E7%A7%AF%E5%85%AC%E5%BC%8F"><span class="toc-text">二维连续卷积公式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E4%BE%8B%E5%AD%90%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-text">一些例子的理解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E5%9B%BE%E5%83%8F%E6%8C%89%E7%85%A7%E6%A8%A1%E6%9D%BF%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86"><span class="toc-text">将图像按照模板进行处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BB%A4%E6%B3%A2"><span class="toc-text">滤波</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%95%E5%BD%B1"><span class="toc-text">投影</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%9A%84%E6%9D%A5%E8%AF%B4"><span class="toc-text">总的来说</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%8D%B7%E7%A7%AF%EF%BC%9A"><span class="toc-text">离散卷积：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B7%E7%A7%AF%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">卷积的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%8D%B7%E7%A7%AF%E5%92%8C%E8%BF%9E%E7%BB%AD%E5%87%BD%E6%95%B0%E7%9A%84%E5%8D%B7%E7%A7%AF"><span class="toc-text">离散卷积和连续函数的卷积</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E5%8D%B7%E7%A7%AF%E5%92%8C%E5%BE%AA%E7%8E%AF%E5%8D%B7%E7%A7%AF"><span class="toc-text">线性卷积和循环卷积</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-text">一些问题：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%8F%8D%E8%BD%AC%EF%BC%9F"><span class="toc-text">为什么要反转？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B7%E7%A7%AF%E6%A0%B8%E5%8F%AF%E4%B8%8D%E5%8F%AF%E4%BB%A5%E6%98%AF%E6%94%B9%E5%8F%98%E7%9A%84%EF%BC%9F"><span class="toc-text">卷积核可不可以是改变的？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%A4%A7%E5%B0%8F%E6%98%AF%E6%9C%89%E9%99%90%E7%9A%84"><span class="toc-text">模板的大小是有限的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E6%97%B6%E4%B8%8D%E5%8F%98%E7%B3%BB%E7%BB%9F"><span class="toc-text">线性时不变系统</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%B7%E7%A7%AF%E5%AE%9A%E7%90%86"><span class="toc-text">卷积定理</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/08/robotruck-ref/" title="【内推】无需日语、可远程！加入日本自动驾驶新星 RoboTruck，定义物流未来">【内推】无需日语、可远程！加入日本自动驾驶新星 RoboTruck，定义物流未来</a><time datetime="2026-01-08T09:00:00.000Z" title="发表于 2026-01-08 17:00:00">2026-01-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/16/homelab/" title="All-in-One HomeLab 和多设备多系统远程方案">All-in-One HomeLab 和多设备多系统远程方案</a><time datetime="2025-12-16T23:00:00.000Z" title="发表于 2025-12-17 07:00:00">2025-12-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/15/tittle-tattle-about-input-method/" title="输入法杂谈">输入法杂谈</a><time datetime="2023-06-15T11:00:00.000Z" title="发表于 2023-06-15 19:00:00">2023-06-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/07/what-we-were-talking-about-ten-years-ago/" title="我们把往事的记忆幻化成光影纸质想使之永垂不朽"><img src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/screenshot-20251210-230924.png" data-lazy-src="https://cdn.jsdelivr.net/gh/yvonshong/picbed@master/2013/jiushiyiyu.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="我们把往事的记忆幻化成光影纸质想使之永垂不朽"/></a><div class="content"><a class="title" href="/2023/06/07/what-we-were-talking-about-ten-years-ago/" title="我们把往事的记忆幻化成光影纸质想使之永垂不朽">我们把往事的记忆幻化成光影纸质想使之永垂不朽</a><time datetime="2023-06-07T02:00:00.000Z" title="发表于 2023-06-07 10:00:00">2023-06-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/29/get-started-with-zotero/" title="PDF 文献库解决方案——Zotero">PDF 文献库解决方案——Zotero</a><time datetime="2023-05-29T09:00:00.000Z" title="发表于 2023-05-29 17:00:00">2023-05-29</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2026 By Yvon Shong</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'

  const disqusReset = conf => {
    window.DISQUS && window.DISQUS.reset({
      reload: true,
      config: conf
    })
  }

  const loadDisqus = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyDisqus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    window.disqus_identifier = isShuoshuo ? path : '/2016/04/13/convolution/'
    window.disqus_url = isShuoshuo ? location.origin + path : 'http://www.yvonshong.com/2016/04/13/convolution/'

    const disqus_config = function () {
      this.page.url = disqus_url
      this.page.identifier = disqus_identifier
      this.page.title = '深入理解卷积'
    }

    if (window.DISQUS) disqusReset(disqus_config)
    else {
      const script = document.createElement('script')
      script.src = 'https://shong.disqus.com/embed.js'
      script.setAttribute('data-timestamp', +new Date())
      document.head.appendChild(script)
    }

    btf.addGlobalFn('themeChange', () => disqusReset(disqus_config), 'disqus')
  }

  const getCount = async() => {
    try {
      const eleGroup = document.querySelector('#post-meta .disqus-comment-count')
      if (!eleGroup) return
      const cleanedLinks = eleGroup.href.replace(/#post-comment$/, '')

      const res = await fetch(`https://disqus.com/api/3.0/threads/set.json?forum=shong&api_key=&thread:link=${cleanedLinks}`,{
        method: 'GET'
      })
      const result = await res.json()

      const count = result.response.length ? result.response[0].posts : 0
      eleGroup.textContent = count
    } catch (err) {
      console.error(err)
    }
  }

  if (isShuoshuo) {
    'Disqus' === 'Disqus'
      ? window.shuoshuoComment = { loadComment: loadDisqus }
      : window.loadOtherComment = loadDisqus
    return
  }

  if ('Disqus' === 'Disqus' || !false) {
    if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
    else {
      loadDisqus()
      GLOBAL_CONFIG_SITE.pageType === 'post' && getCount()
    }
  } else {
    window.loadOtherComment = loadDisqus
  }
})()</script></div><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="/"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="Search..." type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.2"></script></div></div></body></html>